void _submit() async {
  if (!validateInputs()) return;

  try {
    setState(() {
      isLoading = true;
    });

    String username = _usernameController.text.trim();
    String password = _passwordController.text.trim();

    if (isLogin) {
      String profileId = await db.loginUser(username, password);
      if (mounted && profileId.isNotEmpty) {
        // Navigate or update state here
        Navigator.pushReplacement(context, MaterialPageRoute(builder: (context) => LoadingPage()));
      } else if (mounted) {
        // Handle empty profileId or failed login
        setState(() {
          _messageError = true;
          _message = "Login failed, please try again.";
          isLoading = false;
        });
      }
    } else {
      // Registration logic if applicable
    }
  } catch (e) {
    if (mounted) {
      setState(() {
        _messageError = true;
        _message = "An error occurred: $e";
        isLoading = false;
      });
    }
  }
}